import{r as _,o as A,c as G,e as l,g as x,f as p,w as r,d as t,i as o,b as k,h as b,t as c,k as f,l as d,F as M,j as q,p as N}from"./index-BV9e5Yt5.js";import{a as H,b as L,d as R,e as J,f as D}from"./formatters-CqNDYFfu.js";import{u as K}from"./useInstanciaGestora-cSU6cze7.js";import{p as y}from"./peiService-DMb0o3t4.js";function Q(){const s=_([]),g=_(null),u=_(null),n=_(!1),m=_(null);return{peis:s,pei:g,peiEstructura:u,loading:n,error:m,obtenerPeis:async()=>{n.value=!0;try{s.value=await y.obtenerTodos()}catch(e){m.value=e}finally{n.value=!1}},obtenerPeiPorId:async e=>{n.value=!0;try{return g.value=await y.obtenerPorId(e),g.value}catch(a){m.value=a}finally{n.value=!1}},createPei:async e=>await y.crear(e),updatePei:async(e,a)=>{try{return(await y.update(e,a)).data}catch(v){throw console.error("Axios: No se pudo actualizar el proyecto",v),v}},delPei:async e=>{try{return(await y.delProyecto(e)).data}catch(a){console.error("Comp: no se pudo eliminar el proyecto",a)}},obtenerEstructuraPeiPorId:async e=>{n.value=!0;try{return u.value=await y.getEstructuraPorId(e),u.value}catch(a){m.value=a}finally{n.value=!1}}}}const U={class:"d-flex align-center w-100"},W={class:"project-title-container"},X={class:"text-h5 font-weight-bold project-title text-wrap"},Y={class:"text-subtitle-1 text-medium-emphasis project-subtitle"},Z={key:0,class:"text-caption text-medium-emphasis mt-1 font-italic",style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},ee={key:0,class:"mt-2 d-flex flex-wrap"},te={class:"d-flex align-center mb-2"},oe={class:"d-flex align-center mb-2"},ae={class:"d-flex align-center mb-2"},se={class:"d-flex align-center mb-2"},ie={__name:"ProyectoHeader",props:{proyecto:{type:Object,required:!0},activarDetalles:{type:Boolean,default:!1},activarEditar:{type:Boolean,default:!1}},emits:["click","view","edit"],setup(s,{emit:g}){const u=s,n=g,{instanciasParaChips:m,getInstanciasByIds:I,cargarInstancias:C}=K(),{obtenerPeiPorId:E}=Q(),P=_(null);A(async()=>{var w;if((w=u.proyecto)!=null&&w.pei)try{P.value=await E(u.proyecto.pei)}catch(e){console.warn("No se pudo cargar el PEI:",e)}m.value.length===0&&await C()});const h=G(()=>I(u.proyecto.instancia_gestora));return(w,e)=>{const a=l("v-icon"),v=l("v-spacer"),z=l("v-chip"),V=l("v-tooltip"),F=l("v-card-title"),j=l("v-col"),O=l("v-row"),S=l("v-card-text"),B=l("v-btn"),T=l("v-card-actions"),$=l("v-card");return p(),x($,{variant:"outlined",elevation:"1",class:"project-card",onClick:e[2]||(e[2]=i=>n("click"))},{default:r(()=>[t(F,{class:"project-header"},{default:r(()=>[o("div",U,[t(a,{icon:"mdi-notebook",size:"x-large",class:"mr-3",color:"primary"}),o("div",W,[o("h2",X,c(s.proyecto.titulo),1),o("div",Y," CODIGO: "+c(s.proyecto.codigo),1),P.value&&P.value.titulo?(p(),k("div",Z," PEI: "+c(P.value.titulo),1)):b("",!0)]),t(v),t(z,{"prepend-icon":"mdi-progress-check",color:f(H)(s.proyecto.estado),size:"small",class:"status-chip"},{default:r(()=>[d(c(f(L)(s.proyecto.estado)),1)]),_:1},8,["color"])]),h.value.length?(p(),k("div",ee,[(p(!0),k(M,null,q(h.value,i=>(p(),x(z,{key:i.id,class:"ma-1",color:f(R)(i.codigo),label:"",size:"small"},{default:r(()=>[t(a,{start:"",icon:f(J)(i.codigo),size:"small"},null,8,["icon"]),d(" "+c(i.text)+" ",1),t(V,{activator:"parent",location:"top"},{default:r(()=>[d(" CÃ³digo: "+c(i.codigo)+" | Clasificador: "+c(i.clasificador||"N/A"),1)]),_:2},1024)]),_:2},1032,["color"]))),128))])):b("",!0)]),_:1}),t(S,{class:"project-content"},{default:r(()=>[t(O,null,{default:r(()=>[t(j,{cols:"12",sm:"6"},{default:r(()=>[o("div",te,[t(a,{icon:"mdi-calendar",class:"mr-2",size:"small"}),o("span",null,[e[3]||(e[3]=o("strong",null,"Fecha inicio:",-1)),d(" "+c(f(D)(s.proyecto.fecha_inicio)),1)])]),o("div",oe,[t(a,{icon:"mdi-calendar-end",class:"mr-2",size:"small"}),o("span",null,[e[4]||(e[4]=o("strong",null,"Fecha fin:",-1)),d(" "+c(f(D)(s.proyecto.fecha_finalizacion)),1)])])]),_:1}),t(j,{cols:"12",sm:"6"},{default:r(()=>[o("div",ae,[t(a,{icon:"mdi-account",class:"mr-2",size:"small"}),o("span",null,[e[5]||(e[5]=o("strong",null,"Responsable:",-1)),d(" "+c(s.proyecto.creado_por),1)])]),o("div",se,[t(a,{icon:"mdi-finance",class:"mr-2",size:"small"}),o("span",null,[e[6]||(e[6]=o("strong",null,"Presupuesto:",-1)),d(" "+c(s.proyecto.presupuesto),1)])])]),_:1})]),_:1})]),_:1}),t(T,{class:"project-actions"},{default:r(()=>[s.activarDetalles?(p(),x(B,{key:0,variant:"text",color:"primary","prepend-icon":"mdi-eye",onClick:e[0]||(e[0]=N(i=>n("view"),["stop"]))},{default:r(()=>e[7]||(e[7]=[d(" Ver detalles ")])),_:1,__:[7]})):b("",!0),t(v),s.activarEditar?(p(),x(B,{key:1,variant:"tonal",color:"secondary","prepend-icon":"mdi-pencil",onClick:e[1]||(e[1]=N(i=>n("edit"),["stop"]))},{default:r(()=>e[8]||(e[8]=[d(" Editar ")])),_:1,__:[8]})):b("",!0)]),_:1})]),_:1})}}};export{ie as _};
