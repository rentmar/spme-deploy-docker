import{_ as ze,r as u,a as Ae,o as Ge,c as I,b as U,d as t,w as l,e as s,F as Q,u as Qe,f as p,g as H,h as D,i as r,t as i,j as de,k as g,l as n,m as N}from"./index-BV9e5Yt5.js";import{u as He}from"./peiStore-HYkZ2mAe.js";import{g as oe,f as F}from"./formatters-CqNDYFfu.js";import{p as ve}from"./peiService-DMb0o3t4.js";const Je={class:"text-caption text-grey"},Ke={class:"d-flex align-center"},We={class:"text-caption mt-1"},Xe={class:"d-flex"},Ye={key:0},Ze={class:"d-flex justify-end mt-4"},he={key:2,class:"d-flex align-center justify-space-between mt-2"},et={class:"text-caption text-grey"},tt={__name:"PeiViewList",setup(lt){const ce=Qe(),ae=He(),x=u({show:!1,text:"",color:"success"}),V=u(!1),ne=u(null),$=u(!1),J=u(null),B=u(null),S=u(""),M=u("datos"),j=u(!1),L=u(!1),K=u(!1),W=u(!1),X=u(null),c=Ae({titulo:"",descripcion:"",fecha_inicio:null,fecha_fin:null,esta_vigente:!1}),_e=[a=>!!a||"El título es requerido",a=>a&&a.length>=1||"El título debe tener al menos 5 caracteres",a=>a&&a.length<=100||"El título no puede exceder 100 caracteres"],fe=[a=>!!a||"La descripción es requerida",a=>a&&a.length>=1||"La descripción debe tener al menos 10 caracteres",a=>a&&a.length<=500||"La descripción no puede exceder 500 caracteres"],pe=()=>{ge(),j.value=!0},me=()=>{j.value=!1},ge=()=>{var a;c.value={titulo:"",descripcion:"",fecha_inicio:"",fecha_fin:"",esta_vigente:!1},(a=X.value)==null||a.resetValidation()},xe=async()=>{const{valid:a}=await X.value.validate();a&&(L.value=!0)},ye=async()=>{var a,e;try{W.value=!0;const y=(await ve.crear(c)).id;console.log("resouesta"),console.log(y),x.value={show:!0,text:"PEI creado exitosamente",color:"success"},setTimeout(()=>{ce.push(`/pei/${y}/editar/`)},1500),L.value=!1,j.value=!1}catch(m){console.error("Error al crear el PEI",m),x.value={show:!0,text:((e=(a=m.response)==null?void 0:a.data)==null?void 0:e.message)||"Error al crear el PEI",color:"error"}}finally{W.value=!1}},E=u(1),b=u(10),R=u([]),Ve=[{text:"Vigentes",value:!0},{text:"No vigentes",value:!1}];Ge(async()=>{await ie()});const be=I(()=>ae.peis),_=I(()=>{let a=be.value;if(S.value){const e=S.value.toLowerCase();a=a.filter(m=>m.titulo.toLowerCase().includes(e)||m.descripcion&&m.descripcion.toLowerCase().includes(e))}return R.value.length>0&&(a=a.filter(e=>R.value.includes(e.esta_vigente))),a}),we=I(()=>{const a=(E.value-1)*b.value,e=a+b.value;return _.value.slice(a,e)}),se=I(()=>Math.ceil(_.value.length/b.value)),Pe=I(()=>(E.value-1)*b.value+1),Ee=I(()=>{const a=E.value*b.value;return a>_.value.length?_.value.length:a}),ie=async()=>{try{V.value=!0,ne.value=null,await ae.obtenerPeis()}catch(a){ne.value="Error al cargar los PEIs: "+(a.message||"Intente nuevamente más tarde"),console.error("Error al cargar los PEIs",a)}finally{V.value=!1}},re=a=>_.value.filter(e=>e.esta_vigente===a).length,ke=a=>{J.value=a,$.value=!0},Ce=async()=>{try{V.value=!0,await ve.eliminar(J.value.id),x.value={show:!0,text:"PEI eliminado exitosamente",color:"success"},await ie()}catch(a){console.error("Error al eliminar el PEI",a)}finally{V.value=!1,$.value=!1}},Ie=()=>{alert("Exportar a Excel")},Ue=a=>{B.value=B.value===a?null:a};return(a,e)=>{const m=s("v-progress-linear"),y=s("v-card-title"),O=s("v-text-field"),ue=s("v-chip"),De=s("v-chip-group"),q=s("v-card-text"),f=s("v-icon"),Ne=s("v-avatar"),T=s("v-list-item-title"),z=s("v-list-item-subtitle"),v=s("v-btn"),k=s("v-tooltip"),w=s("v-list-item"),A=s("v-tab"),Fe=s("v-tabs"),C=s("v-col"),Y=s("v-row"),G=s("v-window-item"),Z=s("v-alert"),$e=s("v-window"),P=s("v-card"),je=s("v-expand-transition"),h=s("v-list"),Le=s("v-pagination"),qe=s("v-select"),Te=s("v-toolbar"),Be=s("v-textarea"),Se=s("v-form"),ee=s("v-spacer"),te=s("v-card-actions"),le=s("v-dialog"),Me=s("v-container"),Re=s("v-snackbar");return p(),U(Q,null,[t(Me,null,{default:l(()=>[V.value?(p(),H(m,{key:0,indeterminate:"",color:"primary",height:"4",class:"mb-4"})):D("",!0),t(Y,null,{default:l(()=>[t(C,{cols:"12",md:"9",lg:"9"},{default:l(()=>[t(P,{class:"pa-4",elevation:"2"},{default:l(()=>[t(y,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[19]||(e[19]=r("span",null,"Lista de PEIs",-1)),r("span",Je,"Total: "+i(_.value.length),1)]),_:1,__:[19]}),t(q,{class:"pt-0 pb-4"},{default:l(()=>[t(O,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=o=>S.value=o),label:"Buscar PEIs (por título o descripción)","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",density:"comfortable",onInput:e[1]||(e[1]=o=>E.value=1)},null,8,["modelValue"]),t(De,{modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=o=>R.value=o),multiple:"",column:"",class:"mt-2"},{default:l(()=>[(p(),U(Q,null,de(Ve,o=>t(ue,{key:o.value,value:o.value,filter:"",color:g(oe)(o.value),variant:"outlined"},{default:l(()=>[n(i(o.text),1)]),_:2},1032,["value","color"])),64))]),_:1},8,["modelValue"])]),_:1}),V.value?D("",!0):(p(),H(h,{key:0,class:"py-0"},{default:l(()=>[(p(!0),U(Q,null,de(we.value,o=>(p(),U(Q,{key:o.id},[t(w,{value:o,class:"mb-2"},{prepend:l(()=>[t(Ne,{color:g(oe)(o.esta_vigente),class:"mr-4"},{default:l(()=>[t(f,{dark:""},{default:l(()=>e[20]||(e[20]=[n("mdi-notebook-edit")])),_:1,__:[20]})]),_:2},1032,["color"])]),append:l(()=>[r("div",Xe,[t(k,{text:"Ver detalles",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-eye-outline",variant:"text",color:"primary",to:`/pei/${o.id}/detalle`}),null,16,["to"])]),_:2},1024),t(k,{text:"Editar",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-pencil",variant:"text",color:"warning",to:`/pei/${o.id}/editar`}),null,16,["to"])]),_:2},1024),t(k,{text:"Objetivos",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-target",variant:"text",color:"secondary",to:`/pei/${o.id}/objetivos`}),null,16,["to"])]),_:2},1024),t(k,{text:"Indicadores",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-chart-bar",variant:"text",color:"teal",to:`/pei/${o.id}/indicadores`}),null,16,["to"])]),_:2},1024),t(k,{text:"Eliminar",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-delete",variant:"text",color:"error",onClick:Oe=>ke(o)}),null,16,["onClick"])]),_:2},1024),t(k,{text:"Vista rápida",location:"top"},{activator:l(({props:d})=>[t(v,N({ref_for:!0},d,{icon:"mdi-chevron-down",variant:"text",color:"info",onClick:Oe=>Ue(o.id),class:{"rotate-180":B.value===o.id}}),null,16,["onClick","class"])]),_:2},1024)])]),default:l(()=>[t(T,{class:"font-weight-bold"},{default:l(()=>[n(i(o.titulo),1)]),_:2},1024),t(z,{class:"mt-1"},{default:l(()=>[r("div",Ke,[t(ue,{small:"",color:g(oe)(o.esta_vigente),"text-color":"white",class:"mr-2"},{default:l(()=>[n(i(o.esta_vigente?"Vigente":"No vigente"),1)]),_:2},1032,["color"]),r("span",null,i(g(F)(o.fecha_inicio))+" - "+i(g(F)(o.fecha_fin)),1)]),r("div",We,i(o.descripcion),1)]),_:2},1024)]),_:2},1032,["value"]),t(je,null,{default:l(()=>[B.value===o.id?(p(),U("div",Ye,[t(P,{elevation:"0",class:"ml-10 mr-4 mb-4 bg-grey-lighten-4"},{default:l(()=>[t(Fe,{modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=d=>M.value=d),color:"primary",grow:""},{default:l(()=>[t(A,{value:"datos"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[21]||(e[21]=[n("mdi-information")])),_:1,__:[21]}),e[22]||(e[22]=n(" Datos "))]),_:1,__:[22]}),t(A,{value:"objetivos"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[23]||(e[23]=[n("mdi-target")])),_:1,__:[23]}),e[24]||(e[24]=n(" Objetivos "))]),_:1,__:[24]}),t(A,{value:"indicadores"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[25]||(e[25]=[n("mdi-chart-bar")])),_:1,__:[25]}),e[26]||(e[26]=n(" Indicadores "))]),_:1,__:[26]}),t(A,{value:"proyectos"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[27]||(e[27]=[n("mdi-notebook-multiple")])),_:1,__:[27]}),e[28]||(e[28]=n(" Proyectos "))]),_:1,__:[28]})]),_:1},8,["modelValue"]),t(q,{class:"pt-4"},{default:l(()=>[t($e,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=d=>M.value=d)},{default:l(()=>[t(G,{value:"datos"},{default:l(()=>[t(Y,null,{default:l(()=>[t(C,{cols:"12",md:"6"},{default:l(()=>[r("p",null,[e[29]||(e[29]=r("strong",null,"Descripción:",-1)),n(" "+i(o.descripcion),1)]),r("p",null,[e[30]||(e[30]=r("strong",null,"Vigencia:",-1)),n(" "+i(o.esta_vigente?"Vigente":"No vigente"),1)]),r("p",null,[e[31]||(e[31]=r("strong",null,"Fecha de creación:",-1)),n(" "+i(g(F)(o.creado_el)),1)])]),_:2},1024),t(C,{cols:"12",md:"6"},{default:l(()=>[r("p",null,[e[32]||(e[32]=r("strong",null,"Fecha inicio:",-1)),n(" "+i(g(F)(o.fecha_inicio)),1)]),r("p",null,[e[33]||(e[33]=r("strong",null,"Fecha fin:",-1)),n(" "+i(g(F)(o.fecha_fin)),1)]),r("p",null,[e[34]||(e[34]=r("strong",null,"Última modificación:",-1)),n(" "+i(g(F)(o.modificado_el)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(G,{value:"objetivos"},{default:l(()=>[t(Z,{type:"info",variant:"tonal"},{default:l(()=>e[35]||(e[35]=[n(" Información de objetivos disponible en la vista completa ")])),_:1,__:[35]})]),_:1}),t(G,{value:"indicadores"},{default:l(()=>[t(Z,{type:"info",variant:"tonal"},{default:l(()=>e[36]||(e[36]=[n(" Información de indicadores disponible en la vista completa ")])),_:1,__:[36]})]),_:1}),t(G,{value:"proyectos"},{default:l(()=>[t(Z,{type:"info",variant:"tonal"},{default:l(()=>e[37]||(e[37]=[n(" Información de proyectos asociados disponible en la vista completa ")])),_:1,__:[37]})]),_:1})]),_:2},1032,["modelValue"]),r("div",Ze,[t(v,{color:"primary",variant:"text",size:"small",to:`/pei/${o.id}/detalle`},{default:l(()=>e[38]||(e[38]=[n(" Ver detalles completos ")])),_:2,__:[38]},1032,["to"])])]),_:2},1024)]),_:2},1024)])):D("",!0)]),_:2},1024)],64))),128)),_.value.length===0&&!V.value?(p(),H(w,{key:0},{default:l(()=>[t(T,{class:"text-grey"},{default:l(()=>e[39]||(e[39]=[n("No se encontraron PEIs")])),_:1,__:[39]})]),_:1})):D("",!0)]),_:1})),se.value>1?(p(),H(Le,{key:1,modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=o=>E.value=o),length:se.value,"total-visible":7,class:"mt-4"},null,8,["modelValue","length"])):D("",!0),_.value.length>0?(p(),U("div",he,[r("span",et," Mostrando "+i(Pe.value)+"-"+i(Ee.value)+" de "+i(_.value.length),1),t(qe,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value=o),items:[5,10,20,50],label:"Items por página",density:"compact",style:{"max-width":"150px"},variant:"outlined"},null,8,["modelValue"])])):D("",!0)]),_:1})]),_:1}),t(C,{cols:"12",md:"3",lg:"3"},{default:l(()=>[t(P,{class:"mb-4",elevation:"2"},{default:l(()=>[t(y,{class:"primary white--text"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[40]||(e[40]=[n("mdi-cog")])),_:1,__:[40]}),e[41]||(e[41]=n(" Acciones "))]),_:1,__:[41]}),t(h,{density:"comfortable"},{default:l(()=>[t(w,{onClick:pe,title:"Nuevo PEI","prepend-icon":"mdi-plus-circle",class:"text-primary"}),t(w,{title:"Exportar lista","prepend-icon":"mdi-file-export",onClick:Ie})]),_:1})]),_:1}),t(P,{elevation:"2"},{default:l(()=>[t(y,{class:"primary white--text"},{default:l(()=>[t(f,{left:""},{default:l(()=>e[42]||(e[42]=[n("mdi-chart-box")])),_:1,__:[42]}),e[43]||(e[43]=n(" Estadísticas "))]),_:1,__:[43]}),t(h,{density:"comfortable"},{default:l(()=>[t(w,null,{prepend:l(()=>[t(f,{color:"primary"},{default:l(()=>e[44]||(e[44]=[n("mdi-file-document-multiple")])),_:1,__:[44]})]),default:l(()=>[t(T,null,{default:l(()=>e[45]||(e[45]=[n("Total PEIs")])),_:1,__:[45]}),t(z,{class:"text-right"},{default:l(()=>[n(i(_.value.length),1)]),_:1})]),_:1}),t(w,null,{prepend:l(()=>[t(f,{color:"success"},{default:l(()=>e[46]||(e[46]=[n("mdi-check-circle")])),_:1,__:[46]})]),default:l(()=>[t(T,null,{default:l(()=>e[47]||(e[47]=[n("Vigentes")])),_:1,__:[47]}),t(z,{class:"text-right"},{default:l(()=>[n(i(re(!0)),1)]),_:1})]),_:1}),t(w,null,{prepend:l(()=>[t(f,{color:"grey"},{default:l(()=>e[48]||(e[48]=[n("mdi-close-circle")])),_:1,__:[48]})]),default:l(()=>[t(T,null,{default:l(()=>e[49]||(e[49]=[n("No vigentes")])),_:1,__:[49]}),t(z,{class:"text-right"},{default:l(()=>[n(i(re(!1)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(le,{modelValue:j.value,"onUpdate:modelValue":e[12]||(e[12]=o=>j.value=o),"max-width":"600",persistent:""},{default:l(()=>[t(P,null,{default:l(()=>[t(Te,{color:"primary",title:"Nuevo PEI"}),t(q,{class:"pt-4"},{default:l(()=>[t(Se,{ref_key:"peiForm",ref:X,modelValue:K.value,"onUpdate:modelValue":e[11]||(e[11]=o=>K.value=o)},{default:l(()=>[t(O,{modelValue:c.titulo,"onUpdate:modelValue":e[7]||(e[7]=o=>c.titulo=o),label:"Título*",rules:_e,required:"",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),t(Be,{modelValue:c.descripcion,"onUpdate:modelValue":e[8]||(e[8]=o=>c.descripcion=o),label:"Descripción*",rules:fe,required:"",variant:"outlined",rows:"3",class:"mb-4"},null,8,["modelValue"]),t(Y,null,{default:l(()=>[t(C,{cols:"12",md:"6"},{default:l(()=>[t(O,{modelValue:c.fecha_inicio,"onUpdate:modelValue":e[9]||(e[9]=o=>c.fecha_inicio=o),label:"Fecha de inicio*",type:"date",max:c.fecha_fin,required:"",variant:"outlined"},null,8,["modelValue","max"])]),_:1}),t(C,{cols:"12",md:"6"},{default:l(()=>[t(O,{modelValue:c.fecha_fin,"onUpdate:modelValue":e[10]||(e[10]=o=>c.fecha_fin=o),label:"Fecha de fin*",type:"date",min:c.fecha_inicio,required:"",variant:"outlined"},null,8,["modelValue","min"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(te,null,{default:l(()=>[t(ee),t(v,{color:"grey",onClick:me},{default:l(()=>e[50]||(e[50]=[n("Cancelar")])),_:1,__:[50]}),t(v,{color:"primary",onClick:xe,loading:W.value,disabled:!K.value},{default:l(()=>e[51]||(e[51]=[n(" Guardar ")])),_:1,__:[51]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=o=>L.value=o),"max-width":"400"},{default:l(()=>[t(P,null,{default:l(()=>[t(y,{class:"text-h5"},{default:l(()=>e[52]||(e[52]=[n("Confirmar creación")])),_:1,__:[52]}),t(q,null,{default:l(()=>e[53]||(e[53]=[n(" ¿Estás seguro de que deseas crear este nuevo PEI? ")])),_:1,__:[53]}),t(te,null,{default:l(()=>[t(ee),t(v,{color:"grey",onClick:e[13]||(e[13]=o=>L.value=!1)},{default:l(()=>e[54]||(e[54]=[n("Cancelar")])),_:1,__:[54]}),t(v,{color:"primary",onClick:ye},{default:l(()=>e[55]||(e[55]=[n("Sí, crear")])),_:1,__:[55]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:$.value,"onUpdate:modelValue":e[16]||(e[16]=o=>$.value=o),"max-width":"400"},{default:l(()=>[t(P,null,{default:l(()=>[t(y,{class:"text-h5"},{default:l(()=>e[56]||(e[56]=[n("Confirmar eliminación")])),_:1,__:[56]}),t(q,null,{default:l(()=>{var o;return[n(' ¿Estás seguro de que deseas eliminar el PEI "'+i((o=J.value)==null?void 0:o.titulo)+'"? ',1)]}),_:1}),t(te,null,{default:l(()=>[t(ee),t(v,{color:"grey",onClick:e[15]||(e[15]=o=>$.value=!1)},{default:l(()=>e[57]||(e[57]=[n("Cancelar")])),_:1,__:[57]}),t(v,{color:"error",onClick:Ce},{default:l(()=>e[58]||(e[58]=[n("Eliminar")])),_:1,__:[58]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Re,{modelValue:x.value.show,"onUpdate:modelValue":e[18]||(e[18]=o=>x.value.show=o),color:x.value.color,timeout:"3000"},{actions:l(()=>[t(v,{variant:"text",onClick:e[17]||(e[17]=o=>x.value.show=!1)},{default:l(()=>e[59]||(e[59]=[n(" Cerrar ")])),_:1,__:[59]})]),default:l(()=>[n(i(x.value.text)+" ",1)]),_:1},8,["modelValue","color"])],64)}}},it=ze(tt,[["__scopeId","data-v-25ca0513"]]);export{it as default};
